(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[510],{2336:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/phone",function(){return t(8131)}])},4763:function(e,n,t){"use strict";t.d(n,{Z:function(){return I}});var o=t(5893),l=t(3971),i=t(1569),s=t(9944),a=t(4477),d=t(7183),r=t(4491),c=t(9361),u=t(2075),h=t(8508),p=t(1577),m=t(4627),x=t(5675),f=t.n(x),g=t(7294),v=t(8276),j=t(1163),y=t(1664),Z=t.n(y);let{Header:k,Sider:w,Content:_}=d.Z,{Text:b,Title:C}=r.Z;function I(e){let{children:n,title:t}=e,[r,x]=(0,g.useState)(!1),[y,b]=(0,g.useState)(80),{t:I}=(0,v.$G)("common"),S=(0,j.useRouter)(),{token:{colorWhite:F}}=c.Z.useToken();return(0,o.jsxs)(d.Z,{className:"layout",style:{minHeight:"100%"},children:[(0,o.jsxs)(w,{trigger:null,collapsible:!0,collapsed:r,collapsedWidth:y,breakpoint:"sm",onBreakpoint:e=>{x(e),e?b(0):b(90)},theme:"dark",style:{overflow:"auto",height:"100vh",position:"fixed",left:0,top:0,bottom:0,zIndex:1,paddingTop:0==y?60:0},children:[(0,o.jsxs)(u.Z,{style:{padding:"10px 5px",width:"100%",alignItems:"center",justifyContent:"center"},children:[(0,o.jsx)(f(),{style:{flex:0},src:"/troll-face.gif",width:"50",height:"40",alt:"logo"}),!r&&(0,o.jsx)(C,{style:{fontSize:"1.5em",color:"white",whiteSpace:"nowrap"},children:"Doran WA"})]}),(0,o.jsxs)(h.Z,{theme:"dark",mode:"inline",selectedKeys:[S.asPath],children:[(0,o.jsx)(h.Z.Item,{title:I("dashboard"),children:(0,o.jsx)(Z(),{href:"/dashboard",children:(0,o.jsxs)(u.Z,{size:"middle",children:[(0,o.jsx)(l.Z,{}),!r&&I("dashboard")]})})},"/dashboard"),(0,o.jsx)(h.Z.Item,{title:I("phone_devices"),children:(0,o.jsx)(Z(),{href:"/dashboard/phone",children:(0,o.jsxs)(u.Z,{size:"middle",children:[(0,o.jsx)(i.Z,{}),!r&&I("phone_devices")]})})},"/dashboard/phone")]})]}),(0,o.jsxs)(d.Z,{className:"layout",style:{minHeight:"100%",transition:"all 0.2s,background 0s",marginLeft:r?y:0==y?0:"200px"},children:[(0,o.jsxs)(k,{style:{position:"sticky",top:0,zIndex:1,width:"100%",display:"flex",alignItems:"center",paddingLeft:10,paddingRight:10,justifyContent:"space-between",color:F},children:[(0,o.jsxs)(u.Z,{style:{flex:1},children:[(0,o.jsx)(p.ZP,{type:"ghost",style:{color:F},onClick:()=>x(!r),children:r?(0,o.jsx)(s.Z,{}):(0,o.jsx)(a.Z,{})}),(0,o.jsx)("div",{style:{fontWeight:"bold",fontSize:"1.1em"},children:t})]}),(0,o.jsxs)(h.Z,{theme:"dark",mode:"horizontal",selectable:!1,style:{width:200,display:"flex",justifyContent:"flex-end"},children:[(0,o.jsx)(h.Z.Item,{onClick:()=>{let{pathname:e,asPath:n,query:t}=S;S.push({pathname:e,query:t},n,{locale:(null===v.ag||void 0===v.ag?void 0:v.ag.language)=="id"?"en":"id"})},children:(0,o.jsx)(m.Z,{content:(0,o.jsx)("div",{children:(null===v.ag||void 0===v.ag?void 0:v.ag.language)=="id"?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("b",{children:"Indonesia/"}),"English"]}):(0,o.jsxs)(o.Fragment,{children:["Indonesia",(0,o.jsx)("b",{children:"/English"})]})}),children:null===v.ag||void 0===v.ag?void 0:v.ag.language.toUpperCase()})}),(0,o.jsx)(h.Z.Item,{children:(0,o.jsx)(Z(),{href:"/signout",children:I("signout")})})]})]}),(0,o.jsx)(_,{style:{padding:"0 20px",marginTop:"10px"},children:n})]})]})}},8131:function(e,n,t){"use strict";t.r(n),t.d(n,{__N_SSG:function(){return N},default:function(){return O}});var o=t(5893),l=t(4763),i=t(7294),s=t(9367);let a=e=>{let[n,t]=(0,i.useState)(null),[o,l]=(0,i.useState)(null),a=()=>{if(o){for(let e of o)null==n||n.off(e.name);null==n||n.disconnect()}};return(0,i.useEffect)(()=>{if(!o){a();return}let n=(0,s.io)(e);for(let e of o)n.on(e.name,e.handler);return n.connect(),t(n),function(){a()}},[o]),{socket:n,setEvents:l,disconnectSocket:a}};var d=t(9099),r=t(2075),c=t(4491),u=t(5081),h=t(4059),p=t(8276);function m(e){let{open:n,phone:t,userId:l,...s}=e,[m,x]=(0,i.useState)(void 0),[f,g]=(0,i.useState)(0),[v,j]=(0,i.useState)(!1),[y,Z]=(0,i.useState)(!1),{socket:k,setEvents:w}=a({query:{phoneId:null==t?void 0:t.id,userId:l}}),{t:_}=(0,p.$G)();return(0,i.useEffect)(()=>{if(!n||!t){w(null),null==k||k.disconnect();return}w([{name:"connect",handler(){console.log("connect","connected")}},{name:"disconnect",handler(){console.log("connect","disconnect")}},{name:"credsUpdate",handler(e){}},{name:"authState",handler(e){console.log("authState",e)}},{name:"connectionState",handler(e){console.log(e),"isOnline"in e&&s.onClose&&s.onClose(),"connection"in e&&Z("connecting"===e.connection)}},{name:"qr",handler(e){e.phoneId==(null==t?void 0:t.id)&&(console.log(e),x(e.qr),g(e.timeout>0?e.timeout/1e3:0))}}])},[n,t]),(0,i.useEffect)(()=>{let e=setInterval(()=>{g(f-1)},1e3);return()=>{clearInterval(e)}},[f]),(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(d.Z,{title:_("whatsaap_qrcode"),closable:!1,open:n,onCancel:()=>{x(void 0),(null==s?void 0:s.onClose)&&(null==s||s.onClose())},children:(0,o.jsx)(r.Z,{direction:"vertical",style:{display:"flex",width:"100%",alignItems:"center"},children:m?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(h.tv,{style:{margin:"0 auto"},width:"300px",height:"300px",value:m}),(0,o.jsxs)(c.Z.Text,{children:[_("timeout"),": ",f]}),(0,o.jsx)(c.Z.Text,{children:_("please_scan_qrcode")})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c.Z.Text,{children:_("getting_qrcode")}),(0,o.jsx)(u.Z,{size:"large"})]})})})})}var x=t(1552),f=t(8863);let g=(0,i.forwardRef)((e,n)=>{let{open:t,onSubmit:l,onCancel:s,editPhone:a,...r}=e,{t:c}=(0,p.$G)("common"),[u]=x.Z.useForm();(0,i.useEffect)(()=>(a&&(u.setFieldValue("id",a.id),u.setFieldValue("name",a.name)),()=>{u.resetFields()}),[a]);let h=()=>{u.resetFields()};return(0,i.useImperativeHandle)(n,()=>({resetForm:h})),(0,o.jsx)(d.Z,{open:t,title:r.title||"",okText:c("save"),cancelText:c("cancel"),onCancel:s,okButtonProps:{loading:null==r?void 0:r.loading},cancelButtonProps:{disabled:null==r?void 0:r.loading},onOk:()=>{null==u||u.validateFields().then(e=>{l(e)}).catch(e=>{})},children:(0,o.jsxs)(x.Z,{disabled:null==r?void 0:r.loading,form:u,layout:"vertical",name:"phone-form",initialValues:{modifier:"public"},children:[(0,o.jsx)(x.Z.Item,{name:"id",hidden:!0,children:(0,o.jsx)(f.Z,{})}),(0,o.jsx)(x.Z.Item,{name:"name",label:c("name"),rules:[{required:!0,message:c("validation.required",{field:c("name")}).toString()}],children:(0,o.jsx)(f.Z,{})})]})})});g.displayName="PhoneFormModal";var v=t(6548),j=t(7516),y=t(8689),Z=t(2952),k=t(882),w=t(3159),_=t(1577);function b(e){let{phone:n,onEditClick:t,onGetQrCodeClick:l,onDeleteClick:i}=e,{t:s}=(0,p.$G)("common"),a=[{label:s("edit"),key:"1",icon:(0,o.jsx)(v.Z,{}),onClick:e=>t&&t(n,e)},{label:s("scan_qrcode"),key:"2",icon:(0,o.jsx)(j.Z,{}),onClick:e=>l&&l(n,e)},{label:s("delete"),key:"3",icon:(0,o.jsx)(y.Z,{}),onClick:e=>i&&i(n,e)}];return(0,o.jsx)(w.Z,{menu:{items:a},trigger:["click"],children:(0,o.jsx)(_.ZP,{children:(0,o.jsxs)(r.Z,{children:[(0,o.jsx)(Z.Z,{}),"Action",(0,o.jsx)(k.Z,{})]})})})}let C=async e=>{let{target:n,message:t,value:o}=e;try{let e="";if(!navigator.clipboard)throw Error("Browser don't have support for native clipboard.");if(n){let e=document.querySelector(n);if(!e||!e.textContent)throw Error("Element not found");o=e.textContent}o&&(e=o),await navigator.clipboard.writeText(e),console.log(null!=t?t:"Copied!!!")}catch(e){console.log(e.toString())}};var I=t(6154),S=t(9204),F=t(3009),P=t(4874),E=t(7484),z=t.n(E),T=t(3299);let q=()=>{var e,n;let[t,l]=(0,i.useState)({openForm:!1,formLoading:!1,openQrModal:!1,selectedPhone:void 0,editPhone:void 0}),{data:s}=(0,T.useSession)(),c=function(e){let[n,t]=(0,i.useState)(!1),[o,l]=(0,i.useState)([]),s=()=>{t(!0)};(0,i.useEffect)(()=>{t(!0)},[]),(0,i.useEffect)(()=>{let o=async()=>{t(!1);let n=await I.Z.get("/api/phones",{headers:{Authorization:"Bearer ".concat(e)}}),o=n.data;l(o)};n&&e&&o()},[n,e]);let a=async n=>{let o={success:!1,error:void 0,data:void 0};try{let l=await I.Z.delete("/api/phones/".concat(n),{headers:{Authorization:"Bearer ".concat(e)}});o.success=!0,o.data=l.data,t(!0)}catch(e){S.d7,o.error=e}return o},d=async n=>{let o={success:!1,error:void 0,data:void 0};try{let l=await I.Z.post("/api/phones",n,{headers:{Authorization:"Bearer ".concat(e)}});o.success=!0,o.data=l.data,t(!0)}catch(e){S.d7,o.error=e}return o};return{phones:o,setPhones:l,save:d,deleteById:a,refetchPhone:s}}(null==s?void 0:null===(e=s.user)||void 0===e?void 0:e.token),[u,h]=(0,i.useState)([]),[x,f]=(0,i.useState)(void 0),{socket:v,setEvents:j}=a(x),{t:y,i18n:Z}=(0,p.$G)("common"),[k,w]=d.Z.useModal(),[E,q]=F.Z.useNotification(),N=(0,i.useRef)(null);(0,i.useEffect)(()=>{var e,n,t;if(0>=((null===(e=c.phones)||void 0===e?void 0:e.length)||0)){f(void 0);return}return f({query:{userId:null==s?void 0:null===(n=s.user)||void 0===n?void 0:n.id,phoneId:null===(t=c.phones)||void 0===t?void 0:t.map(e=>e.id)},autoConnect:!1}),()=>{f(void 0)}},[c.phones]),(0,i.useEffect)(()=>{if(!x||t.openForm){null==v||v.disconnect();return}let e=[];return e.push({name:"isOnline",handler:e=>{console.log("isOnline",e),h([...u,e.phoneId])}}),e.push({name:"waUser",handler:e=>{let n=c.phones,t=null==n?void 0:n.find(n=>n.id===e.phoneId);t&&(t.account_name=e.waUser.name,t.number=e.waUser.id.split(":")[0],c.setPhones(n),console.log("waUser updated",e))}}),e.push({name:"connect",handler:()=>{console.log("connect")}}),j(e),null==v||v.connect(),()=>{j([]),null==v||v.disconnect()}},[x,t.openForm]);let O=[{title:y("name"),key:"name",dataIndex:"name"},{title:y("number"),key:"number",dataIndex:"number"},{title:y("account_name"),key:"account_name",dataIndex:"account_name",render:e=>(0,o.jsx)("div",{style:{whiteSpace:"nowrap"},children:e})},{title:y("api_token"),key:"token",dataIndex:"token",render:e=>(0,o.jsxs)(r.Z,{direction:"horizontal",style:{whiteSpace:"nowrap"},children:[(0,o.jsx)(_.ZP,{onClick:async()=>{await C({value:e}),E.destroy(),E.success({closeIcon:!1,duration:3,message:y("text_copied",{text:'"Token"'}).toString()||"Copied",placement:"bottom"})},children:"Copy"}),(0,o.jsx)("div",{children:e})]})},{title:"Online",key:"id",dataIndex:"id",render:e=>u.includes(e)?"Online":"Offline"},{title:y("created_at"),key:"createdAt",dataIndex:"createdAt",render:e=>(0,o.jsx)("div",{style:{whiteSpace:"nowrap"},children:z()(e).format("DD/MM/YYYY HH:mm")})},{title:y("action"),key:"action",dataIndex:"id",fixed:"right",render:(e,n)=>(0,o.jsx)(b,{phone:n,onEditClick:A,onDeleteClick:G,onGetQrCodeClick:L})}],M=async e=>{l({...t,formLoading:!0});let n=await c.save(e);if(n.success){var o;null===(o=N.current)||void 0===o||o.resetForm()}l({...t,formLoading:!1,openForm:!1,editPhone:void 0})},B=()=>l({...t,openForm:!1,editPhone:void 0}),A=e=>{e&&l({...t,editPhone:e,openForm:!0})},G=e=>{e&&k.confirm({title:y("confirm_delete"),content:y("confirm_delete_ask"),onOk:async()=>{let n=await c.deleteById(e.id);E[n.success?"success":"error"]({message:n.success?y("success"):y("failed"),description:n.success?y("success_delete"):y("failed_delete")})}})},L=e=>{e&&l({...t,selectedPhone:e,openQrModal:!0})};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(_.ZP,{onClick:()=>l({...t,openForm:!0}),children:y("add_devices")}),(0,o.jsx)(g,{ref:N,loading:t.formLoading,open:t.openForm,onCancel:B,onSubmit:M,editPhone:t.editPhone}),(0,o.jsx)(P.Z,{scroll:{x:!0},onRow:e=>({onContextMenu:n=>{n.preventDefault(),console.log(e)}}),dataSource:c.phones,columns:O}),(0,o.jsx)(m,{userId:null==s?void 0:null===(n=s.user)||void 0===n?void 0:n.id,open:t.openQrModal,phone:t.selectedPhone||void 0,onClose:()=>l({...t,openQrModal:!1})}),w,q]})};q.getLayout=function(e){return(0,o.jsx)(l.Z,{title:((null===p.ag||void 0===p.ag?void 0:p.ag.t("phone_devices"))||"").toUpperCase(),children:e})};var N=!0,O=q}},function(e){e.O(0,[675,791,165,204,34,774,888,179],function(){return e(e.s=2336)}),_N_E=e.O()}]);